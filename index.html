<p id="debug">ç­‰å¾…é€£ç·š...</p> <!-- ç”¨ä¾†é¡¯ç¤º Debug è¨Šæ¯ -->

<script>
async function connectBluetooth() {
    try {
        const device = await navigator.bluetooth.requestDevice({
            filters: [{ services: ["ffe0"] }]  // ç¢ºä¿ UUID æ­£ç¢º
        });

        const server = await device.gatt.connect();
        const service = await server.getPrimaryService("ffe0");
        characteristic = await service.getCharacteristic("ffe1");

        document.getElementById("debug").innerText = "âœ… å·²é€£ç·šï¼Œé–‹å§‹æ¥æ”¶æ•¸æ“š";
        startNotifications();

    } catch (error) {
        document.getElementById("debug").innerText = "âŒ é€£ç·šå¤±æ•—ï¼š" + error;
    }
}

function startNotifications() {
    if (!characteristic) {
        document.getElementById("debug").innerText = "âš ï¸ ç‰¹å¾µå€¼æœªåˆå§‹åŒ–ï¼Œç„¡æ³•è®€å–æ•¸æ“š";
        return;
    }

    characteristic.startNotifications().then(() => {
        document.getElementById("debug").innerText = "ğŸ”µ BLE é€šçŸ¥å•Ÿå‹•æˆåŠŸï¼";

        characteristic.addEventListener("characteristicvaluechanged", (event) => {
            let emgString = new TextDecoder().decode(event.target.value.buffer);
            let emg = parseInt(emgString.trim());

            document.getElementById("emgValue").innerText = "EMG æ•¸å€¼: " + emg;
            document.getElementById("debug").innerText = "âš¡ æ”¶åˆ° EMG æ•¸æ“šï¼š" + emgString;
        });
    }).catch(error => {
        document.getElementById("debug").innerText = "âŒ å•Ÿå‹•é€šçŸ¥å¤±æ•—ï¼š" + error;
    });
}
</script>
