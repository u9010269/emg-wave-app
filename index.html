<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>EMG 藍牙監測頁</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #log { white-space: pre-line; border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll; }
  </style>
</head>
<body>
  <h2>EMG Web Bluetooth 接收測試</h2>
  <button onclick="connect()">連線藍牙裝置</button>
  <p>即時數值：<span id="value">尚未接收</span></p>
  <div id="log"></div>

  <script>
    let logArea = document.getElementById("log");
    let valueSpan = document.getElementById("value");

    function log(msg) {
      console.log(msg);
      logArea.textContent += msg + '\n';
    }

    async function connect() {
      try {
        log("開始掃描裝置...");
        const device = await navigator.bluetooth.requestDevice({
          filters: [{ namePrefix: 'MLT-BT05' }],
          optionalServices: ['ffe0']
        });

        log("已選擇裝置：" + device.name);
        const server = await device.gatt.connect();
        const service = await server.getPrimaryService('ffe0');
        const characteristic = await service.getCharacteristic('ffe1');

        await characteristic.startNotifications();
        log("已啟用通知");

        characteristic.addEventListener('characteristicvaluechanged', (event) => {
          const decoder = new TextDecoder('utf-8');
          const value = decoder.decode(event.target.value);
          valueSpan.textContent = value.trim();
          log("接收值：" + value);
        });

      } catch (err) {
        log("錯誤：" + err);
      }
    }
  </script>
</body>
</html>
