<p id="debug">等待連線...</p> <!-- 用來顯示 Debug 訊息 -->

<script>
async function connectBluetooth() {
    try {
        const device = await navigator.bluetooth.requestDevice({
            filters: [{ services: ["ffe0"] }]  // 確保 UUID 正確
        });

        const server = await device.gatt.connect();
        const service = await server.getPrimaryService("ffe0");
        characteristic = await service.getCharacteristic("ffe1");

        document.getElementById("debug").innerText = "✅ 已連線，開始接收數據";
        startNotifications();

    } catch (error) {
        document.getElementById("debug").innerText = "❌ 連線失敗：" + error;
    }
}

function startNotifications() {
    if (!characteristic) {
        document.getElementById("debug").innerText = "⚠️ 特徵值未初始化，無法讀取數據";
        return;
    }

    characteristic.startNotifications().then(() => {
        document.getElementById("debug").innerText = "🔵 BLE 通知啟動成功！";

        characteristic.addEventListener("characteristicvaluechanged", (event) => {
            let emgString = new TextDecoder().decode(event.target.value.buffer);
            let emg = parseInt(emgString.trim());

            document.getElementById("emgValue").innerText = "EMG 數值: " + emg;
            document.getElementById("debug").innerText = "⚡ 收到 EMG 數據：" + emgString;
        });
    }).catch(error => {
        document.getElementById("debug").innerText = "❌ 啟動通知失敗：" + error;
    });
}
</script>
