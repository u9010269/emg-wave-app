<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>EMG Bluetooth 測試</title>
</head>
<body>
  <h3>EMG 即時數值</h3>
  <button onclick="connect()">連接藍牙</button>
  <div id="value">--</div>

  <script>
    let characteristic;

    async function connect() {
      try {
        const device = await navigator.bluetooth.requestDevice({
          filters: [{ namePrefix: 'MLT' }],
          optionalServices: ['ffe0']
        });

        const server = await device.gatt.connect();
        const service = await server.getPrimaryService('ffe0');
        characteristic = await service.getCharacteristic('ffe1');

        document.getElementById('value').innerText = '已連線，開始輪詢數據...';

        pollEMG();
      } catch (error) {
        console.error('連接錯誤：', error);
        document.getElementById('value').innerText = '錯誤：' + error;
      }
    }

    function pollEMG() {
      const decoder = new TextDecoder('utf-8');
      setInterval(async () => {
        try {
          const value = await characteristic.readValue();
          const text = decoder.decode(value);
          console.log('讀取字串：', text.trim());
          document.getElementById('value').innerText = text.trim();
        } catch (err) {
          console.error('讀取失敗：', err);
        }
      }, 500); // 每 500ms 輪詢一次
    }
  </script>
</body>
</html>
