<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>EMG 即時數值（Polling 版）</title>
</head>
<body>
  <h3>EMG 即時數值</h3>
  <button onclick="connectBluetooth()">連接藍牙</button>
  <p id="value">即時數值：--</p>

  <script>
    let characteristic;

    async function connectBluetooth() {
      try {
        const device = await navigator.bluetooth.requestDevice({
          filters: [{ namePrefix: 'MLT' }],
          optionalServices: ['ffe0']
        });

        const server = await device.gatt.connect();
        const service = await server.getPrimaryService('ffe0');
        characteristic = await service.getCharacteristic('ffe1');

        console.log("已連接裝置，開始輪詢讀取值");
        setInterval(readEMG, 100); // 每 100ms 抓一次
      } catch (error) {
        console.error('藍牙連接失敗:', error);
      }
    }

    async function readEMG() {
      try {
        const value = await characteristic.readValue();
        const decoder = new TextDecoder('utf-8');
        const emg = decoder.decode(value);
        document.getElementById('value').innerText = '即時數值：' + emg;
        console.log('EMG:', emg);
      } catch (error) {
        console.warn('讀取失敗:', error);
      }
    }
  </script>
</body>
</html>
