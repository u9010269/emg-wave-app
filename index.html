<!DOCTYPE html>
<html>
<head>
  <title>EMG Web Bluetooth 測試</title>
</head>
<body>
  <h3>EMG Bluetooth 接收測試</h3>
  <button onclick="connect()">連接藍牙</button>
  <p id="status">尚未連接</p>
  <textarea id="log" rows="20" cols="50"></textarea>

<script>
let device, characteristic;

async function connect() {
  document.getElementById("status").textContent = "連線中...";
  try {
    device = await navigator.bluetooth.requestDevice({
      filters: [{ namePrefix: 'MLT-BT05' }],
      optionalServices: ['ffe0']
    });

    const server = await device.gatt.connect();
    const service = await server.getPrimaryService('ffe0');
    characteristic = await service.getCharacteristic('ffe1');

    await characteristic.startNotifications();
    characteristic.addEventListener('characteristicvaluechanged', handleNotify);

    document.getElementById("status").textContent = "已連線並啟用通知";
  } catch (err) {
    document.getElementById("status").textContent = "錯誤：" + err;
  }
}

function handleNotify(event) {
  const value = event.target.value;
  let hexStr = '';
  for (let i = 0; i < value.byteLength; i++) {
    hexStr += value.getUint8(i).toString(16).padStart(2, '0') + ' ';
  }

  const log = document.getElementById("log");
  log.value = `[${new Date().toLocaleTimeString()}] ${hexStr}\n` + log.value;
}
</script>
</body>
</html>
